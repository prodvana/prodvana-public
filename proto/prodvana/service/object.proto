syntax = "proto3";
package prodvana.service;
option go_package = "github.com/prodvana/prodvana-public/go/prodvana-sdk/proto/prodvana/service";

import "prodvana/object/meta.proto";
import "prodvana/common_config/meta.proto";
import "prodvana/service/service_config.proto";
import "prodvana/service/user_metadata.proto";

message ExternalAddr {
    enum Type {
        UNKNOWN = 0;
        AUTO = 1;
        EXTERNAL = 2;
        // RAW_* are generated by the underlying infrastructure, independent of Prodvana
        RAW_IP = 3;
        RAW_HOSTNAME = 4;
    }
    string addr = 1;
    Type type = 2;
}

message ServiceState {
    reserved 1, 2;
    reserved "ongoing_pipeline_runs", "state";
}

message Service {
    prodvana.object.ObjectMeta meta = 1;
    ServiceConfig config = 2;
    ServiceState state = 3;
    ServiceUserMetadata user_metadata = 4;
}

message ServiceInstanceState {
    repeated ExternalAddr external_addrs = 7;

    reserved 1, 2, 3, 4, 5, 6, 8, 9, 10, 11, 12;
    reserved "state", "available_pods", "desired_pods", "latest_successful_prodvana_push", "latest_successful_unknown_push_after_prodvana_push", "ongoing_push", "pods", "runtime_id", "runtime_name", "writeback_config", "delivery_state";

    // next tag: 13
}

message ServiceInstance {
    prodvana.common_config.ServiceInstanceObjectMeta meta = 1;
    CompiledServiceInstanceConfig config = 2;  // will be empty if never pushed
    ServiceInstanceState state = 3;
}
